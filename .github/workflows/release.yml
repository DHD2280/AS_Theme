name: Make Release


on:
  push:
    tags: 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Source Code Download
        run: git clone --branch master --single-branch --recurse-submodules https://github.com/DHD2280/AS_Theme.git .

      - name: Shell Scripts Permissions
        run: chmod +x .github/*.sh

      - name: Version Bump
        run: .github/bumpVersion.sh

      - name: Extract Changes
        run: .github/extractChanges.sh

      - name: Gradlew Permissions
        run: chmod +x gradlew

      - name: Version Bump Commit
        uses: github-actions-x/commit@v2.9
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          push-branch: 'master'
          commit-message: 'Version update: Release'
          force-add: 'true'
          files: app/build.gradle.kts app/src/main/res/values/theme_configurations.xml app/src/main/res/values-it/theme_configurations.xml
          name: GitHub
          email: ASTheme@tugaia.it

      - name: Theme Binary Release
        uses: ncipollo/release-action@v1.14.0
        with:
          tag: ${{ env.VTag }}
          name: ${{ env.VName }}
          body: ${{ env.TMessage }}
          prerelease: true
          allowUpdates: false
          draft: false
